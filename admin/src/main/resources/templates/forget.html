<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>忘记密码</title>
    <link rel="stylesheet" href="${request.contextPath}/statics/css/bootstrap.min.css">
    <link rel="stylesheet" href="${request.contextPath}/statics/css/font-awesome.min.css">
    <link rel="stylesheet" href="${request.contextPath}/statics/css/AdminLTE.min.css">
    <link rel="stylesheet" href="${request.contextPath}/statics/css/all-skins.min.css">
    <link rel="stylesheet" href="${request.contextPath}/statics/css/main.css">
    <link rel="stylesheet" href="${request.contextPath}/statics/css/layui.css">
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  </head>
  <body>
      <div class="login_box" id="rrapp">
          <div class="login-logo">
              <b>100分社区管理系统</b>
          </div>
          <!-- /.login-logo -->
          <div class="login-box-body">
              <p class="login-box-msg">管理员登录</p>
              <div v-if="error" class="alert alert-danger alert-dismissible">
                  <h4 style="margin-bottom: 0px;"><i class="fa fa-exclamation-triangle"></i></h4>
              </div>
              <div class="form-group has-feedback">
                  <input type="text" class="form-control" v-model="username" placeholder="账号">
                  <span class="glyphicon glyphicon-user form-control-feedback"></span>
              </div>
              <div class="form-group has-feedback">
                  <input type="password" class="form-control" v-model="password" placeholder="密码">
                  <span class="glyphicon glyphicon-lock form-control-feedback"></span>
              </div>
              <div class="form-group has-feedback">
                  <input type="text" class="form-control" v-model="captcha" @keyup.enter="login" placeholder="验证码">
                  <span class="glyphicon glyphicon-warning-sign form-control-feedback"></span>
              </div>
              <div class="form-group has-feedback">
                  <img alt="如果看不清楚，请单击图片刷新！" class="pointer" :src="src" @click="refreshCode">
                  &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" @click="refreshCode">点击刷新</a>
              </div>

              <div class="row">
                  <div class="col-xs-8">
                      <div class="checkbox icheck">
                      </div>
                  </div>
                  <div class="col-xs-4">
                      <button type="button" class="btn btn-primary btn-block btn-flat" @click="login">登录</button>
                  </div>
              </div>
          </div>
      </div>
      <script src="${request.contextPath}/statics/libs/jquery.min.js"></script>
      <script src="${request.contextPath}/statics/libs/vue.min.js"></script>
      <script src="${request.contextPath}/statics/libs/bootstrap.min.js"></script>
      <script src="${request.contextPath}/statics/libs/jquery.slimscroll.min.js"></script>
      <script src="${request.contextPath}/statics/libs/fastclick.min.js"></script>
      <script src="${request.contextPath}/statics/libs/app.js"></script>
  <script>
      var vm = new Vue({
          el:'#rrapp',
          data:{
              username: '',
              password: '',
              captcha: '',
              error: false,
              errorMsg: '',
              src: 'captcha.jpg'
          },
          beforeCreate: function(){
              if(self != top){
                  top.location.href = self.location.href;
              }
          },
          methods: {
              refreshCode: function(){
                  this.src = "captcha.jpg?t=" + $.now();
              },
              login: function (event) {
                  var data = "username="+vm.username+"&password="+vm.password+"&captcha="+vm.captcha;
                  $.ajax({
                      type: "POST",
                      url: "sys/login",
                      data: data,
                      dataType: "json",
                      success: function(result){
                          if(result.status == "success"){//登录成功
                              parent.location.href ='index.html';
                          }else{
                              vm.error = true;
                              vm.errorMsg = result.data;
                              vm.refreshCode();
                          }
                      }
                  });
              }
          }
      });
  </script>
  </body>
  </html>