<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="${request.contextPath}/statics/plugins/diyUpload/globle.css">
    <style>
        .layui-btn {
            display: inline-block;
            height: 30px;
            line-height: 30px;
            padding: 0 18px;
            background-color: #009688;
            color: #fff;
            white-space: nowrap;
            text-align: center;
            font-size: 14px;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            margin: 5px 10px;
        }
    </style>
    <#include "/header.html">
</head>
<body>
<div >
    <div v-show="showList">
        <div class="grid-btn">
            <div class="form-group col-sm-2">
                <input type="text" class="form-control" id="title"  @keyup.enter="reload" placeholder="名称">
            </div>
            <#if shiro.hasPermission("invitation:select")>
                <a class="btn btn-default" onclick="reload()">查询</a>
            </#if>
            <#if shiro.hasPermission("invitation:add")>
                <a class="btn btn-primary" onclick="add()" ><i class="fa fa-plus"></i>&nbsp;新增</a>
            </#if>
            <#if shiro.hasPermission("invitation:delete")>
                <a class="btn btn-primary" onclick="deleteById()"><i class="fa fa-trash-o"></i>&nbsp;删除</a>
            </#if>
        </div>
        <table id="jqGrid"></table>
        <div id="jqGridPager"></div>
    </div>
</div>
</body>
<script>
    $(function () {
        $("#jqGrid").jqGrid({
            url: baseURL + 'mobile/invitation/pageList',
            datatype: "json",
            mtype:"POST",
            colModel: [
                { label: 'id', name: 'id', index: "id", width: 45, key: true,hidden:true },
                { label: '标题', name: 'title',  width: 45 },
                { label: '社区', name: 'communityName', width: 75 },
                { label: '图片', name: 'imgJson', width: 90 ,
                    editable:true,
                    formatter:function (cellvalue, options, rowObject) {
                        var temp ="";
                        $.each(JSON.parse(cellvalue),function (index,item) {
                             temp += '<img style="height: 30px;width: 30px;" src="'+item.path+'"/>'
                        });
                        return temp;
                    }
                },
                { label: '创建时间', name: 'createTime', width: 100 },
                { label: '详情', width: 40,
                    formatter:function (cellvalue, options, rowObject) {
                        return "<bnttom class='layui-btn' onclick='getById("+rowObject.id+")'>详情</bnttom>"
                } }
            ],
            viewrecords: true,
            height: 385,
            rowNum: 10,
            rowList : [10,30,50],
            rownumbers: true,
            rownumWidth: 25,
            autowidth:true,
            multiselect: true,
            pager: "#jqGridPager",
            jsonReader : {
                root: "page.list",
                page: "page.currPage",
                total: "page.totalPage",
                records: "page.totalCount"
            },
            prmNames : {
                page:"page",
                rows:"limit",
                order: "order"
            },
            gridComplete:function(){
                //隐藏grid底部滚动条
                $("#jqGrid").closest(".ui-jqgrid-bdiv").css({ "overflow-x" : "hidden" });
            }
        });
    });


    function reload() {
        var page = $("#jqGrid").jqGrid('getGridParam','page');
        $("#jqGrid").jqGrid('setGridParam',{
            postData:{'title': $("#title").val()},
            page:page
        }).trigger("reloadGrid");
    }
    function add() {
        layer.open({
            type: 2,
            skin: 'layui-layer-molv',
            title: "公告",
            area: ['850px', '550px'],
            fixed:false,
            content: baseURL + "mobile/invitation/getSavePage?type=1&id=-1",
            closeBtn:1,
            btn: ['确定','取消'],
            yes:function(index,layero){//    //点击确定回调
                var form = layer.getChildFrame('form', index);
                console.info(form.serialize());
                $.ajax({
                    type:"POST",
                    url:baseURL + "mobile/invitation/save",
                    datType:"JSON",
                    data:form.serialize(),
                    success:function (result) {
                        layer.close(index);
                        if(result.respCode =="1000"){
                            alert(result.data);
                            reload();
                        }else {
                            alert(result.data);
                        }

                    }
                });

            }
        });
    }

    function getById(id) {

        layer.open({
            type: 2,
            skin: 'layui-layer-molv',
            title: "详情",
            area: ['850px', '550px'],
            fixed:false,
            content: baseURL + "mobile/invitation/getSavePage?type=2&id="+id,
            closeBtn:1,
            btn: ['确定','取消'],
            yes:function(index,layero){//    //点击确定回调
                layer.close(index);
            }
        });
    }

    function deleteById (){
        var ids = getSelectedRows();
        if(ids == null){
            return ;
        }
        confirm('确定要删除选中的记录？', function(){
            $.ajax({
                type: "POST",
                url: baseURL + "mobile/invitation/delete",
                contentType: "application/json",
                data: JSON.stringify(ids),
                success: function(result){
                    alert('删除成功', function(){
                        reload();
                    });
                }
            });
        });
    }
</script>
</html>