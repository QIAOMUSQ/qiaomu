<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qiaomu.modules.workflow.dao.YwWorkflowInfoDao">
    <select id="getAll" resultType="com.qiaomu.modules.workflow.entity.YwWorkflowInfo">
        SELECT * FROM
          yw_workflow_info w
        LEFT JOIN yw_workflow_message m ON m.id = w.workflow_id
        <where>
            1=1
            <if test="userId !=null and userId !=''">
                AND w.user_id= #{userId}
            </if>
            <if test="communityId !=null and communityId !=''">
                AND w.community_id= #{communityId}
            </if>
            <if test="workflowType !=null and workflowType !=''">
                AND w.workflow_type= #{workflowType}
            </if>
            <if test="type !=null and type !=''">
                AND w.type= #{type}
            </if>
            <if test="workflowId !=null and workflowId !=''">
                AND w.workflow_id= #{workflowId}
            </if>
            <if test="workflowIds !=null and workflowIds !=''">
                AND w.workflow_id in #{workflowIds}
            </if>
            <if test="status !=null and status !=''">
                AND w.status= #{status}
            </if>
        </where>
        ORDER BY w.create_time DESC
    </select>

    <!--communityId/companyId/workflowType/type/userId/communityName-->
    <select id="selectPageAll" resultType="com.qiaomu.modules.workflow.entity.YwWorkflowInfo">
        SELECT
          *
        FROM
            yw_workflow_info w
            LEFT JOIN yw_workflow_message m ON m.id = w.workflow_id
            LEFT JOIN yw_community c ON w.community_id = c.id

        <where>
            1=1
            <if test="companyId != null and companyId!=''">
                and c.company_id = #{companyId}
            </if>
            <if test="communityId != null and communityId!=''">
                and w.community_id = #{communityId}
            </if>
            <if test="workflowType != null and workflowType!=''">
                and w.workflow_type = #{workflowType}
            </if>
            <if test="type != null and type!=''">
                and w.type = #{type}
            </if>
            <if test="userId != null and userId!=''">
                and w.user_id = #{userId}
            </if>
            <if test="communityIds != null">
                and w.community_id in
                <foreach item="communityIds" collection="array" open="(" separator="," close=")">
                    #{communityIds}
                </foreach>
            </if>
        </where>

    </select>


    <select id="getAllWorker" resultType="com.qiaomu.modules.workflow.entity.YwWorkflowInfo">
         SELECT
            *
        FROM
            yw_workflow_info w 
        LEFT JOIN yw_user_workflow u ON u.workflow_id = w.workflow_id
        LEFT JOIN  yw_workflow_message m on m.id=  w.workflow_id
        <where>
            1=1
            <if test="communityId !=null and communityId!=''">
               AND u.community_id = #{communityId}
            </if>
            <if test="userId !=null and userId != ''">
               and u.user_id = #{userId}
            </if>
        </where>
    </select>

</mapper>