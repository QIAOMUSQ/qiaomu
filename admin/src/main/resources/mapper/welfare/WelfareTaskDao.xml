<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">    
<mapper namespace="com.qiaomu.modules.welfare.dao.WelfareTaskDao">

	<!-- 根据key，更新value -->
	<insert id="newTask" parameterType="com.qiaomu.modules.welfare.entity.TaskEntity" >
		insert into welfare_task (serviceId ,serviceName,seviceDetail,status,points,createdAt,updatedAt) VALUES
		(#{serviceId} ,#{serviceName},#{seviceDetail},#{status},#{points},#{createdAt},#{updatedAt})
	</insert>

	<insert id="newTaskUser" parameterType="com.qiaomu.modules.welfare.entity.TaskPublishUserEntity" >
		insert into welfare_task_publish_user (publishUserId ,serviceId,status,createdAt,updatedAt) VALUES
		(#{publishUserId} ,#{serviceId},#{status},#{createdAt},#{updatedAt})
	</insert>

	<insert id="newTaskRecevieUser" parameterType="com.qiaomu.modules.welfare.entity.TaskRecevieUserEntity" >
		insert into welfare_task_recevie_user (receiveUserId ,serviceId,status,createdAt,updatedAt) VALUES
		(#{receiveUserId} ,#{serviceId},#{status},#{createdAt},#{updatedAt})
	</insert>
	<select id="queryTaskByName" parameterType="String" resultType="com.qiaomu.modules.welfare.entity.TaskEntity">
		select * from welfare_task WHERE serviceName = #{serviceName} LIMIT 1
	</select>


	<select id="queryTask" parameterType="String" resultType="com.qiaomu.modules.welfare.entity.TaskEntity">
		select * from welfare_task WHERE serviceId = #{serviceId}
	</select>
	<select id="queryPublishUserTask" parameterType="String" resultType="com.qiaomu.modules.welfare.entity.TaskPublishUserEntity">
		select * from welfare_task_publish_user WHERE serviceId = #{serviceId} Limit 1
	</select>
	<select id="queryPublishUserTaskLast" parameterType="String" resultType="com.qiaomu.modules.welfare.entity.TaskPublishUserEntity">
		select * from welfare_task_publish_user WHERE serviceId = #{serviceId} ORDER by createdAt DESC Limit 1
	</select>
	<select id="queryRecevieUserTask" parameterType="String" resultType="com.qiaomu.modules.welfare.entity.TaskRecevieUserEntity">
		select * from welfare_task_recevie_user WHERE serviceId = #{serviceId} ORDER by createdAt DESC Limit 1
	</select>
	<update id="updateTask" parameterType="com.qiaomu.modules.welfare.entity.TaskEntity">
		update welfare_task set
		<if test="serviceName != null and serviceName !=''">
			serviceName = #{serviceName},
		</if>
		<if test="seviceDetail != null and seviceDetail !=''">
			seviceDetail = #{seviceDetail},
		</if>
		<if test="status != null and status !=''">
			status = #{status},
		</if>
		<if test="points != null and points !=''">
			points = #{points},
		</if>
		<if test="updatedAt != null and updatedAt !=''">
			updatedAt = #{updatedAt}
		</if>
		WHERE serviceId=#{serviceId}
	</update>



	<delete id="deleteTaskByServiceId" parameterType="String">
		delete from welfare_task WHERE serviceId = #{serviceId}
	</delete>

</mapper>